---
title: Enteropathogen antibody dynamics and force of infection among children in low-resource settings
subtitle: Supplementary Information File 4. Sensitivity analysis of change in IgG used to identify presumed unexposed measurements in Haiti and Kenya.
output: 
  html_document:
    theme: default
    highlight: haddock
    toc: true
    toc_depth: 3
    toc_float:
      collapsed: true
      smooth_scroll: true
---

# Notebook summary

### Identifying presumed seroconverters
One approach to identifying a seropositivity cutoff in a longitudinal study is to identify children who presumably seroconvert from negative to positive based on a change in their antibody levels, and then use the distribution of their antibody levels before seroconversion to identify a seropositivity cutoff.  The rationale for this two-step process that estimates a cutoff (and does not simply classify children as seroconverers versus not) is that the cutoff can then be applied to identify children who were seropositive but did not actually seroconvert during the study. This was common for antibody response to enteric pathogens in the study cohorts, where exposure ocurred frequently and very early in life.

### Level of increase in antibody levels to identify seroconversion
The method relies on choosing the appropriate magnitude of change in antibody levels used identify presumed seroconverters, which is generally unknown.  Most immunogenicity abnd pathogen challenge studies have used a 4-fold increase. In this study, we used an increase of +2 or more on the log$_{10}$ scale, equal to a 100-fold increase, to identify presumed seroconverters. Although this was likely a conservative assumption, it still led to high levels of agreement with other classification approachs (generally >95%) when applied across cohorts and antibodies.

### Sensitivity analysis description 

Here, we conduct a sensitivity analysis that searches over a range of increases in antibody levels used to identify "presumed seroconverters". For each increase, we then calculated the mean and SD of the distribution before the change, and used that as a seropositivity cutoff. We then compared the classification accuracy of each value against classifications based on cutoffs derived from ROC-curves or mixture models, as available.

In the present study, we used two additional methods to determine seropositivity cutoffs:

   * For _Giardia_ (VSP-3, VSP-5), _Cryptosporidium_ (Cp17, Cp23), and _E. histolytica_ (LecA) antigens, known negative and positive samples were used to identify an optimal cutoff based on a receiver-operator characteristic (ROC) curve.  
   * For all other pathogens, we fit a 2-component, finite Gaussian mixture model to the antibody distributions, and then used the lower component's mean plus 3 standard deviations to define a cutoff value. This identified reasonable cutoff values for many, but not all, additional antibodies. In some cases the mixture model based approach did not identify reasonable cutoff values (i.e., near or above the upper limit assay's dynamic range).

Given this other classification information, we compared a range of changes in antibody levels used to identify children who presumably seroconverted in terms of agreement with ROC-based and mixture model-based classification of seropositivity.  

We searched over a range of changes from +0.3 to +2.5 on the log10 MFI-bg scale (this corresponds to a 10^0.3 = 2-fold to 10^2.5 = 316-fold increase in antibody levels). For each change in antibody levels (0.3 to 2.5), we identified the children who would be identified as seroconverters.  From these children, we then estimated the mean plus 3 standard deviations of their antibody levels at their first measurement, when they were presumably unexposed. This is the seropositivity cutoff among the "presumed unexposed".  We then estimated agreement and Cohen's Kappa statistics for each change and identify the magnitude of change that corresponded with the maximum level of agreement.

### Sensitivity analysis results

The optimal change in MFI levels used to identify presumed seroconverters varied by cohort and antigen, where "optimal" was defined as the minimum change in MFI with maximum agreement with respect to ROC-based or mixture model-based seropositivity classifications. 

For antigens with both ROC-based cutoffs and mixture model-based cutoffs, results were similar between the two comparisons. This result reflects good agreement between ROC- and mixture model-based cutoffs (detailed results in this article's Supplementary Information File 2). 

Over the range of values considered, the method led to cutoff values with classification agreement that was very high compared with both ROC- and mixture model-based classifications. In Haiti, optimal agreement exceeded 0.92 for all comparisons. In Kenya, optimal agreement exceeded 0.98 for all comparisons.

In Haiti, the change in MFI values that led to highest agreement were generally $\geq 2$ on the log$_{10}$ scale. In Kenya, change values were lower and generally in the range of 0.5 to 1.5.  In general, across both countries, there was not a large decline in agreement at higher change values imposed to identify presumed seroconverters when developing a cutoff (an exception was _Cryptosporidium_ Cp23 in Kenya). 

Taken together, this sensitivity analysis supports the use of an increase of +2 log$_{10}$ MFI to identify presumed seroconverters in the definition of seropositivity cutoffs for antigens considered. 


# Script preamble
```{r preamble}
#-----------------------------
# preamble
#-----------------------------
library(here)
here()

library(tidyverse)
library(psych)
library(gridExtra)

# set up for parallel computing
# configure for a laptop (use only 3 cores)
library(foreach)
library(doParallel)
registerDoParallel(cores=3)

# bright color blind palette:  https://personal.sron.nl/~pault/ 
cblack <- "#000004FF"
cblue <- "#3366AA"
cteal <- "#11AA99"
cgreen <- "#66AA55"
cchartr <- "#CCCC55"
cmagent <- "#992288"
cred <- "#EE3333"
corange <- "#EEA722"
cyellow <- "#FFEE33"
cgrey <- "#777777"

```


# Leogane, Haiti

## Load the formatted data

```{r haiti data format}
#-----------------------------
# load the formatted data
# created with 
# haiti-enteric-ab-data-format.Rmd ->
# haiti-enteric-ab-distributions.Rmd
#-----------------------------
dl <- readRDS(here("data","haiti_analysis2.rds"))

# list the enteric antigens and formatted labels for them
mbavars <- c("vsp3","vsp5","cp17","cp23","leca","salb","sald","etec","norogi","norogii")

mbalabs <- c("Giardia VSP-3","Giardia VSP-5","Cryptosporidium Cp17","Cryptosporidium Cp23","E. histolytica LecA","Salmonella LPS group B","Salmonella LPS group D","ETEC LT β subunit","Norovirus GI.4", "Norovirus GII.4.NO")

```

## Sensitivity analysis over fold-change values, ROC-based reference

_Giardia_, _Cryptosporidium_, and _E. histolytica_ antigens have ROC-based cutoff values in this study. For these antigens, search over fold-change values to determine the cutoff with best agreement with ROC-based classification.


```{r haiti roc cut, warning=FALSE}
droc <- dl %>%
  filter(!is.na(roccut)) %>%
  droplevels()

gridroc <- foreach(ab=levels(droc$antigenf),.combine=rbind) %:%
  foreach(icut=seq(0.3,2.5,by=0.01),.combine=rbind) %dopar% {
    
    # downsample to measurements among children <=1 y 
    # who increased by the increment icut in the next period    
    # these are "presumed unexposed" under this cutoff in change icut
    # estimate mean and SD among the presumed unexposed to use as a 
    # seropositivity cutoff
    dmu <- droc %>% 
      ungroup() %>%
      select(antigenf,age,logmfi,logmfidiff) %>%
      filter(antigenf==ab & age <= 1 & logmfidiff>icut) %>%
      summarize(mu=mean(logmfi),sd=sd(logmfi),ucut=mu+3*sd)
    
    # classify all observations using the derived cutoff
    di <- droc %>%  
      filter(antigenf==ab) %>%
      mutate(posi=factor(ifelse(logmfi>dmu$ucut,1,0),levels=c(0,1)))
    
    # estimate agreement
    tabi <- as.vector(table(as.factor(di$posroc),as.factor(di$posi)))
    names(tabi) <- c("roc0cuti0","roc1cuti0","roc0cuti1","roc1cuti1")
    kappai <- psych::cohen.kappa(table(di$posroc,di$posi))$kappa
    tabi <- data.frame(t(tabi))
    tabi <- tabi %>%
      mutate(Nobs=roc0cuti0+roc1cuti0+roc0cuti1+roc1cuti1,
             agreement=(roc0cuti0+roc1cuti1)/Nobs,
             kappa=kappai,
             antigenf=ab,
             abchange=icut,
             abcutoff=dmu$ucut) 
    
  }

gridroc <- gridroc %>% mutate(antigenf=factor(antigenf,levels=levels(droc$antigenf)))

# identify the optimal change based on % agreement, take minimum change
optchgroc <- gridroc %>%
  group_by(antigenf) %>%
  mutate(maxagr=max(agreement,na.rm=TRUE),
         maxchg=ifelse( abs(agreement-maxagr)<0.001,1,0)) %>%
  filter(maxchg==1) %>%
  arrange(antigenf,abchange) %>%
  filter(row_number()==1) %>%
  select(antigenf,optchg=abchange,optagr=agreement,optkap=kappa,optcut=abcutoff)

# merge in the optimal change values
gridroc <- left_join(gridroc,optchgroc,by="antigenf")  %>%
  group_by(antigenf)


```


### Figure to summarize results

General figure scheme:
```{r agreement figure scheme}
# this general figure scheme is specific to results stored in
# gridroc and gridmix objects.

plot_optchange <- function(results,classlab="XXX reference standard") {
  
  nantigens <- length(levels(results$antigenf))
  
  # Figure of cutoff by antibody change threshold
  plot_cutoff <- ggplot(data=results,aes(x=abchange)) +
  geom_line(aes(y=abcutoff),color=cmagent) +
  geom_vline(aes(xintercept=optchg),lty="dashed")+ 
  geom_hline(aes(yintercept=optcut),lty="dashed")+ 
  # labels for optimal change and corresponding cutoff based on % agreement
  geom_label(data=filter(results,row_number()==1),
            aes(x=optchg,y=0.5,label=sprintf("%1.2f",optchg)),
            position=position_nudge(x=0),
            fill="white",label.size=0) + 
  geom_label(data=filter(results,row_number()==1),
            aes(y=optcut,x=0,label=sprintf("%1.2f",optcut)),
            position=position_nudge(y=0,x=0.4),
            fill="white",label.size=0) + 
  facet_wrap(~antigenf,nrow=1,ncol=nantigens) +
  # aesthetics
  scale_y_continuous(breaks=seq(0.5,4,by=0.5))+
  scale_x_continuous(breaks=seq(0,3,by=0.5))+
  coord_cartesian(ylim=c(0.5,4),xlim=c(0,3)) +
  labs(x="log10 change in MFI used to identify presumed seroconverters",y="Estimated seropositivity cutoff (log10 MFI-bg)") +
  theme_minimal()
  
  # Figure of Kappa by antibody change threshold
  plot_kappa <- ggplot(data=results,aes(x=abchange)) +
  # geom_line(aes(y=agreement),color=cgreen) +
  geom_line(aes(y=kappa),color=cblue)+
  geom_vline(aes(xintercept=optchg),lty="dashed")+ 
  geom_hline(aes(yintercept=optkap),lty="dashed")+ 
  # labels for optimal change and corresponding kappa based on % agreement
  geom_label(data=filter(results,row_number()==1),
            aes(x=optchg,y=0,label=sprintf("%1.2f",optchg)),
            position=position_nudge(x=0),
            fill="white",label.size=0) + 
  geom_label(data=filter(results,row_number()==1),
            aes(y=optkap,x=0,label=sprintf("%1.2f",optkap)),
            position=position_nudge(y=0,x=0.4),
            fill="white",label.size=0) + 
  facet_wrap(~antigenf,nrow=1,ncol=nantigens) +
  # aesthetics
  scale_y_continuous(breaks=seq(0,1,by=0.1))+
  scale_x_continuous(breaks=seq(0,3,by=0.5))+
  coord_cartesian(ylim=c(0,1),xlim=c(0,3)) +  
  labs(x="",y=paste("Cohen's Kappa,",classlab)) +
  theme_minimal()
  
  # Figure of Agreement by antibody change threshold
  plot_agree <- ggplot(data=results,aes(x=abchange)) +
  geom_line(aes(y=agreement),color=cgreen) +
  # geom_line(aes(y=kappa),color=corange)+
  geom_vline(aes(xintercept=optchg),lty="dashed")+ 
  geom_hline(aes(yintercept=optagr),lty="dashed")+ 
  # labels for optimal change and agreement based on % agreement
  geom_label(data=filter(results,row_number()==1),
            aes(x=optchg,y=0,label=sprintf("%1.2f",optchg)),
            position=position_nudge(x=0),
            fill="white",label.size=0) + 
  geom_label(data=filter(results,row_number()==1),
            aes(y=optagr,x=0,label=sprintf("%1.2f",optagr)),
            position=position_nudge(y=0,x=0.4),
            fill="white",label.size=0) + 
  facet_wrap(~antigenf,nrow=1,ncol=nantigens) +
  # aesthetics
  scale_y_continuous(breaks=seq(0,1,by=0.1))+
  scale_x_continuous(breaks=seq(0,3,by=0.5))+
  coord_cartesian(ylim=c(0,1),xlim=c(0,3)) +
  labs(x="",y=paste("Agreement,",classlab)) +
  theme_minimal()
  
  # stack the figures into a single panel
  grid.arrange(plot_agree,plot_kappa,plot_cutoff)

}

```

The bottom panel plots the estimated seropositivity cutoff as a function of change in MFI levels used to identify presumed seroconverters. The mean plus 3 SDs of the distribution of antibody levels before presumed seroconversion was used to estimate the cutoff. For a given cutoff, the middle and top panels summarize classification agreement with the ROC-based seropositiity cutoff based on Cohen's Kappa (middle) and proportion agreement (top).

Labeled dashed lines indicate the minimum magnitude of change in antibody levels that led to highest agreement, along with the corresponding seropositivity cutoff values, Cohen's Kappa, and agreement.

```{r haiti grid roc agreement fig, fig.height=6, fig.width=6}
plot_optchange(results=gridroc,classlab="ROC-based classification")
```



## Sensitivity analysis over fold-change values, mixture model-based reference

Search over fold-change values to determine the cutoff with best agreement with mixture model-based classification

```{r haiti mix cut, warning=FALSE}
dmix <- dl %>%
  filter(!is.na(mixcut)) %>%
  droplevels()

gridmix <- foreach(ab=levels(dmix$antigenf),.combine=rbind) %:%
  foreach(icut=seq(0.3,2.5,by=0.01),.combine=rbind) %dopar% {

    # downsample to measurements among children <=1 y 
    # who increased by the increment icut in the next period
    # these are "presumed unexposed" under this cutoff in change icut
    # estimate mean and SD among the presumed unexposed to use as a 
    # seropositivity cutoff
    dmu <- dmix %>% 
      ungroup() %>%
      select(antigenf,age,logmfi,logmfidiff) %>%
      filter(antigenf==ab & age <=1 & logmfidiff>icut)
    
    # if there are <2 obs, cannot estimate mean + SD, so skip
    if(nrow(dmu)>=2) {
      
      dmu <- dmu %>%
        summarize(mu=mean(logmfi),sd=sd(logmfi),ucut=mu+3*sd)
    
      # classify all observations using the derived cutoff
      di <- dmix %>%  
      filter(antigenf==ab) %>%
      mutate(posi=factor(ifelse(logmfi>dmu$ucut,1,0),levels=c(0,1)),
             posmix=factor(posmix,levels=c(0,1)))
    
      tabi <- as.vector(table(di$posmix,di$posi))
      names(tabi) <- c("mix0cuti0","mix1cuti0","mix0cuti1","mix1cuti1")
      kappai <- psych::cohen.kappa(table(di$posmix,di$posi))$kappa
      tabi <- data.frame(t(tabi))
      tabi <- tabi %>%
        mutate(Nobs=mix0cuti0+mix1cuti0+mix0cuti1+mix1cuti1,
             agreement=(mix0cuti0+mix1cuti1)/Nobs,
             kappa=kappai,
             antigenf=ab,
             abchange=icut,
             abcutoff=dmu$ucut) 
      
    } else{
      tabi <- data.frame(mix0cuti0=NA,mix1cuti0=NA,mix0cuti1=NA,mix1cuti1=NA,Nobs=NA,agreement=NA,kappa=NA,antigenf=ab,abchange=icut,abcutoff=NA)
      
      }

    }  

gridmix <- gridmix %>% mutate(antigenf=factor(antigenf,levels=levels(dmix$antigenf)))

# identify the optimal change based on % agreement, take minimum change
optchgmix <- gridmix %>%
  group_by(antigenf) %>%
  mutate(maxagr=max(agreement,na.rm=TRUE),
         maxchg=ifelse( abs(agreement-maxagr)<0.001,1,0)) %>%
  filter(maxchg==1) %>%
  # mutate(agr99=ifelse(agreement>0.99 & !is.na(agreement),1,0)) %>%
  # filter(agr99==1) %>%
  arrange(antigenf,abchange) %>%
  filter(row_number()==1) %>%
  select(antigenf,optchg=abchange,optagr=agreement,optkap=kappa,optcut=abcutoff)

gridmix <- left_join(gridmix,optchgmix,by="antigenf") %>%
  group_by(antigenf)


```

### Figure to summarize results

The bottom panel plots the estimated seropositivity cutoff as a function of change in MFI levels used to identify presumed seroconverters. The mean plus 3 SDs of the distribution of antibody levels before presumed seroconversion was used to estimate the cutoff. For a given cutoff, the middle and top panels summarize classification agreement with the mixture model-based seropositiity cutoff based on Cohen's Kappa (middle) and proportion agreement (top).

Labeled dashed lines indicate the minimum magnitude of change in antibody levels that led to highest agreement, along with the corresponding seropositivity cutoff values, Cohen's Kappa, and agreement.


```{r haiti grid mix agreement fig, fig.height=6, fig.width=9, warning=FALSE}
plot_optchange(results=gridmix,classlab="Mixture model-based classification")

```




# Asembo, Kenya

## Load the formatted data

```{r data format}
#-----------------------------
# load the formatted data
# created with 
# asembo-enteric-ab-data-format.Rmd ->
# asembo-enteric-ab-distributions.Rmd
#-----------------------------
dl <- readRDS(here("data","asembo_analysis2.rds"))

# list the enteric antigens and make formatted labels for them
mbavars <- c("vsp3","vsp5","cp17","cp23","leca","salb","sald","etec","cholera","p18","p39")

mbalabs <- c("Giardia VSP-3","Giardia VSP-5","Cryptosporidium Cp17","Cryptosporidium Cp23","E. histolytica LecA","Salmonella LPS group B","Salmonella LPS group D","ETEC LT β subunit","Cholera toxin β subunit","Campylobacter p18","Campylobacter p39")

dl <- dl %>% mutate(antigenf=factor(antigenf,levels=mbalabs))

```

## Sensitivity analysis over fold-change values, ROC-based reference

_Giardia_ and _Cryptosporidium_ antigens have ROC-based cutoff values in this study. For these antigens, search over fold-change values to determine the cutoff with best agreement with ROC-based classification.


```{r roc cut, warning=FALSE}
droc <- dl %>%
  filter(!is.na(roccut)) %>%
  mutate(antigenf=droplevels(antigenf))

gridroc <- foreach(ab=levels(droc$antigenf),.combine=rbind) %:%
  foreach(icut=seq(0.3,2.5,by=0.01),.combine=rbind) %dopar% {
    
    # downsample to first measurements who increased by the increment icut
    # these are "presumed unexposed" under this cutoff in change icut
    # estimate mean and SD among the presumed unexposed to use as a 
    # seropositivity cutoff
    dmu <- droc %>% 
      ungroup() %>%
      select(antigenf,time,logmfi,logmfidiff) %>%
      filter(antigenf==ab & time=="A" & logmfidiff>icut) %>%
      summarize(mu=mean(logmfi),sd=sd(logmfi),ucut=mu+3*sd)
    
    # classify all observations using the derived cutoff
    di <- droc %>%  
      filter(antigenf==ab) %>%
      mutate(posi=factor(ifelse(logmfi>dmu$ucut,1,0),levels=c(0,1)))
    
    # estimate agreement
    tabi <- as.vector(table(as.factor(di$posroc),as.factor(di$posi)))
    names(tabi) <- c("roc0cuti0","roc1cuti0","roc0cuti1","roc1cuti1")
    kappai <- psych::cohen.kappa(table(di$posroc,di$posi))$kappa
    tabi <- data.frame(t(tabi))
    tabi <- tabi %>%
      mutate(Nobs=roc0cuti0+roc1cuti0+roc0cuti1+roc1cuti1,
             agreement=(roc0cuti0+roc1cuti1)/Nobs,
             kappa=kappai,
             antigenf=ab,
             abchange=icut,
             abcutoff=dmu$ucut) 
    
  }

gridroc <- gridroc %>% mutate(antigenf=factor(antigenf,levels=levels(droc$antigenf)))

# identify the optimal change based on % agreement, take minimum change
optchgroc <- gridroc %>%
  group_by(antigenf) %>%
  mutate(maxagr=max(agreement,na.rm=TRUE),
         maxchg=ifelse( abs(agreement-maxagr)<0.001,1,0)) %>%
  filter(maxchg==1) %>%
  arrange(antigenf,abchange) %>%
  filter(row_number()==1) %>%
  select(antigenf,optchg=abchange,optagr=agreement,optkap=kappa,optcut=abcutoff)

# merge in the optimal change values
gridroc <- left_join(gridroc,optchgroc,by="antigenf")  %>%
  group_by(antigenf)
```


### Figure to summarize results

The bottom panel plots the estimated seropositivity cutoff as a function of change in MFI levels used to identify presumed seroconverters. The mean plus 3 SDs of the distribution of antibody levels before presumed seroconversion was used to estimate the cutoff. For a given cutoff, the middle and top panels summarize classification agreement with the ROC-based seropositiity cutoff based on Cohen's Kappa (middle) and proportion agreement (top).

Labeled dashed lines indicate the minimum magnitude of change in antibody levels that led to highest agreement, along with the corresponding seropositivity cutoff values, Cohen's Kappa, and agreement.


```{r grid roc agreement fig, fig.height=6, fig.width=6}
plot_optchange(results=gridroc,classlab="ROC-based classification")
```


## Sensitivity analysis over fold-change values, mixture model-based reference

Search over fold-change values to determine the cutoff with best agreement with mixture model-based classification

```{r mix cut, warning=FALSE}
dmix <- dl %>%
  filter(!is.na(mixcut)) %>%
  mutate(antigenf=droplevels(antigenf))

gridmix <- foreach(ab=levels(dmix$antigenf),.combine=rbind) %:%
  foreach(icut=seq(0.3,2.5,by=0.01),.combine=rbind) %dopar% {

    # downsample to first measurements who increased by the increment icut
    # these are "presumed unexposed" under this cutoff in change icut
    # estimate mean and SD among the presumed unexposed to use as a 
    # seropositivity cutoff
    dmu <- dmix %>% 
      ungroup() %>%
      select(antigenf,time,logmfi,logmfidiff) %>%
      filter(antigenf==ab & time=="A" & logmfidiff>icut)
    
    # if there are <2 obs, cannot estimate mean + SD, so skip
    if(nrow(dmu)>=2) {
      
      dmu <- dmu %>%
        summarize(mu=mean(logmfi),sd=sd(logmfi),ucut=mu+3*sd)
    
      # classify all observations using the derived cutoff
      di <- dmix %>%  
      filter(antigenf==ab) %>%
      mutate(posi=factor(ifelse(logmfi>dmu$ucut,1,0),levels=c(0,1)),
             posmix=factor(posmix,levels=c(0,1)))
    
      tabi <- as.vector(table(di$posmix,di$posi))
      names(tabi) <- c("mix0cuti0","mix1cuti0","mix0cuti1","mix1cuti1")
      kappai <- psych::cohen.kappa(table(di$posmix,di$posi))$kappa
      tabi <- data.frame(t(tabi))
      tabi <- tabi %>%
        mutate(Nobs=mix0cuti0+mix1cuti0+mix0cuti1+mix1cuti1,
             agreement=(mix0cuti0+mix1cuti1)/Nobs,
             kappa=kappai,
             antigenf=ab,
             abchange=icut,
             abcutoff=dmu$ucut) 
      
    } else{
      tabi <- data.frame(mix0cuti0=NA,mix1cuti0=NA,mix0cuti1=NA,mix1cuti1=NA,Nobs=NA,agreement=NA,kappa=NA,antigenf=ab,abchange=icut,abcutoff=NA)
      
      }

    }  

gridmix <- gridmix %>% mutate(antigenf=factor(antigenf,levels=levels(dmix$antigenf)))

# identify the optimal change based on % agreement, take minimum change
optchgmix <- gridmix %>%
  group_by(antigenf) %>%
  mutate(maxagr=max(agreement,na.rm=TRUE),
         maxchg=ifelse( abs(agreement-maxagr)<0.001,1,0)) %>%
  filter(maxchg==1) %>%
  # mutate(agr99=ifelse(agreement>0.99 & !is.na(agreement),1,0)) %>%
  # filter(agr99==1) %>%
  arrange(antigenf,abchange) %>%
  filter(row_number()==1) %>%
  select(antigenf,optchg=abchange,optagr=agreement,optkap=kappa,optcut=abcutoff)

gridmix <- left_join(gridmix,optchgmix,by="antigenf") %>%
  group_by(antigenf)


```

### Figure to summarize results

The bottom panel plots the estimated seropositivity cutoff as a function of change in MFI levels used to identify presumed seroconverters. The mean plus 3 SDs of the distribution of antibody levels before presumed seroconversion was used to estimate the cutoff. For a given cutoff, the middle and top panels summarize classification agreement with the mixture model-based seropositiity cutoff based on Cohen's Kappa (middle) and proportion agreement (top).

Labeled dashed lines indicate the minimum magnitude of change in antibody levels that led to highest agreement, along with the corresponding seropositivity cutoff values, Cohen's Kappa, and agreement.


```{r grid mix agreement fig, fig.height=6, fig.width=9, warning=FALSE}
plot_optchange(results=gridmix,classlab="Mixture model-based classification")
```



# Session Info
```{r session info}
sessionInfo()
```

