---
title: "Asembo enteric antibody analysis of longitudinal change"
output: 
  html_notebook:
    theme: default
    highlight: haddock
    toc: true
    toc_depth: 3
    toc_float:
      collapsed: true
      smooth_scroll: true
---

# Summary

This script summarizes the change in antibody levels within individual children and also estimates the incidence proportion over a 6-7 month period of seroconversion and seroreversion.

The Asembo study was longitudinal and followed children prospectively. We can estimate the average seroconversion rate among children who were at risk (seronegative) at enrollment and seroconverted during the study. We can also estimate the sero-reversion rate, albeit with very little precision since, with the exception of rotavirus, very few children were at risk (seropositive) at enrollment.

# Script preamble
```{r preamble}
#-----------------------------
# preamble
#-----------------------------
rm(list=ls())
library(tidyverse)
library(mixtools)

# set up for parallel computing
# configure for a laptop (use only 3 cores)
library(foreach)
library(doParallel)
registerDoParallel(cores=3)

# bright color blind palette:  https://personal.sron.nl/~pault/ 
cblack <- "#000004FF"
cblue <- "#3366AA"
cteal <- "#11AA99"
cgreen <- "#66AA55"
cchartr <- "#CCCC55"
cmagent <- "#992288"
cred <- "#EE3333"
corange <- "#EEA722"
cyellow <- "#FFEE33"
cgrey <- "#777777"

```


```{r load data}
#-----------------------------
# load the formatted data
# created with 
# asembo-enteric-ab-data-format.Rmd
#-----------------------------
dl <- readRDS("~/enterics-immuno-epi/data/asembo_analysis2.rds")

# list the enteric antigens and make formatted labels for them
mbavars <- c("vsp3","vsp5","cp17","cp23","leca","rotavirus","salb","sald","p18","p39","etec","cholera")

mbalabs <- c("Giardia VSP-3","Giardia VSP-5","Cryptosporidium Cp17","Cryptosporidium Cp23","E. histolytica LecA","Rotavirus","Salmonella LPS B","Salmonella LPS D","Campylobacter p18","Campylobacter p39","ETEC toxin beta subunit","Cholera toxin beta subunit")
```

# Identify incident changes
Identify children whose status changed  between enrollment and follow-up. Those who changed from negative to positive are seroconverters (`seroi` below), and those who changed from positive to negative are seroreverters (`seror` below).


```{r long incidence}
#-----------------------------
# identify incident 
# seroconversions and reversions
#-----------------------------
# spread the data to wide format to 
# identify incident sero-conversions and sero-reversions
# subset to the individuals measured at both timepoints
dlpw <- dl %>%
  select(childid,antigen,time,serocut,seropos) %>%
  spread(time,seropos) %>% 
  filter(!is.na(A) & !is.na(B)) %>%
  mutate(seroi=ifelse(B==1 & A==0,1,0),
         seror=ifelse(B==0 & A==1,1,0)) %>%
  select(childid,antigen,seroi,seror)

#  merge these new variables back to the main data
dlp <- left_join(dl,dlpw,by=c("childid","antigen"))


```

# Antibody MFI trajectories
Longitudinal antibody trajectories of individual children for all antigens measured, colored by the change in antibody levels (increases and decreases)
```{r change in antibody level figure, fig.height=12, fig.width=6}
#-----------------------------
# Plot individual antibody
# trajectories, colored
# by increases and decreases
#-----------------------------

# create an change category factor for plot aesthetics
dl <- dl %>%
  mutate(mficat=factor(ifelse(logmfidiff>0,"Increase","Decrease"),levels=c("Increase","Decrease")))

# convert time to numeric (for plotting)
dl <- dl %>%
  mutate(svy=ifelse(time=="A",0,1))

log10labs <- c( 
  expression(10^0),
  expression(10^1),
  expression(10^2),
  expression(10^3),
  expression(10^4)
)

ppq <- ggplot(data=filter(dl,!is.na(mficat)),aes(x=svy,y=logmfi,group=factor(childid),color=mficat)) +
  # geom_point(alpha=0.2) +
  geom_line(alpha=0.2) +
  # geom_hline(aes(yintercept=mixcut),linetype="dashed") +
  
  scale_x_continuous(limits=c(-0.25,1.25),breaks=c(0,1),labels=c("Enrollment","Follow-up"))+
  scale_y_continuous(breaks=0:4,labels=log10labs) +
  scale_color_manual(values=c(corange,cteal,"gray80"),
                     guide=guide_legend(title="Change in MFI between measurements:",override.aes = list(alpha=1))
                     ) +
  facet_wrap(~antigenf,nrow=6,ncol=2) +
  labs(x="Measurement",y="Luminex response (MFI-bg)") +
  theme_minimal() +
  theme(
    panel.grid.minor.x = element_blank(),
    panel.grid.minor.y = element_blank(),
    panel.grid.major.y = element_blank(),
    axis.ticks.y=element_line(color="gray80"),
    legend.position = "top"
    )

ppq

# save a PDF version
ggsave("~/enterics-immuno-epi/figs/asembo-ab-long-mfi.pdf",plot=ppq,device="pdf",width=5,height=12)

```

Create the same figure of individual antibody trajectories between measurements, but limit it to antigens with seroincidence measures, and color the trajectories by seroconversion/reversion status. There is value in this because the MFI responses among children who actively seroconverted during the 6 month period help further reveal distributions of "negative" and "positive" responses.

```{r change in antibody seroincidence figure, fig.height=9, fig.width=6}
#-----------------------------
# pull the incidence info
# and just merge it back
# to the full longidudinal data
#-----------------------------

dlp2 <- dlp %>% select(childid,time,antigen,seroi,seror)
dl2 <- left_join(dl,dlp2,by=c("childid","time","antigen"))


# create an incidence category factor for plot aesthetics
dl2$icat <- factor(NA,levels=c("Seroconversion","Seroreversion","No change"))
dl2$icat[dl2$seroi==1] <- "Seroconversion"
dl2$icat[dl2$seror==1] <- "Seroreversion"
dl2$icat[dl2$seroi==0 & dl2$seror==0] <- "No change"


pp <- ggplot(data=filter(dl2,!is.na(icat)),aes(x=svy,y=logmfi,group=factor(childid),color=icat)) +
  # geom_point(alpha=0.2) +
  geom_hline(aes(yintercept=serocut),linetype="dashed",size=0.3) +
  geom_line(alpha=0.2) +
  
  scale_x_continuous(limits=c(-0.25,1.25),breaks=c(0,1),labels=c("Enrollment","Follow-up"))+
  scale_y_continuous(breaks=0:4,labels=log10labs) +
  scale_color_manual(values=c(corange,cteal,"gray80"),
                     guide=guide_legend(title="Sero-incidence:",override.aes = list(alpha=1))
                     ) +
  facet_wrap(~antigenf,nrow=6,ncol=2) +
  labs(x="Measurement",y="Luminex response (MFI-bg)") +
  theme_minimal() +
  theme(
    panel.grid.minor.x = element_blank(),
    panel.grid.minor.y = element_blank(),
    panel.grid.major.y = element_blank(),
    axis.ticks.y=element_line(color="gray80"),
    legend.position = "top" 
    )

pp

# save a PDF version
ggsave("~/enterics-immuno-epi/figs/asembo-ab-long-seroincidence.pdf",plot=pp,device="pdf",width=5,height=8)

```

# Antibody distributions conditional on seroconversion
Taking advantage of the longitudinal measurements within individual children, examine the distributions of antibody response among those who seroconverted.

```{r ab ditributions among sero-converters, fig.height=9, fig.width=6}
dlp3 <- dlp %>% 
  mutate(seroposf=ifelse(seropos==1,"Seropositive","Seronegative"))

pdist <- ggplot(data=filter(dlp3,seroi==1),aes(x=logmfi,group=seroposf,color=seroposf,fill=seroposf))+
  facet_wrap(~antigenf,nrow=6,ncol=2,scales="free_y") +
  geom_histogram(aes(y=..density..),color=NA,position="identity",bins=50,alpha=0.2) +
  geom_density(alpha=0.4) +
  geom_vline(aes(xintercept=serocut))+
  scale_x_continuous(limits = c(0,4.5),breaks = 0:4,labels=log10labs) +
  scale_fill_manual(values=c(cteal,corange),guide=guide_legend(title="Status:")) +
  scale_color_manual(values=c(cteal,corange),guide=FALSE) +
  labs(x="Luminex Response (MFI-bg)") +
  theme_minimal(base_size=14) +
  theme(legend.position = "top")

pdist


```
Examine the distributions of _change_ in antibody response by whether they sero-converted, sero-reverted, or did not change sero-status

```{r ab distribution of change, fig.height=9, fig.width=6}
pdiff <- ggplot(data=filter(dl2,!is.na(icat)),aes(x=logmfidiff,group=icat,color=icat,fill=icat))+
  facet_wrap(~antigenf,nrow=6,ncol=2,scales="free_y") +
  geom_histogram(bins=50,alpha=0.4) +
  scale_fill_manual(values=c(corange,cteal,cgrey),guide=guide_legend(title="Seroincidence:")) +
  scale_color_manual(values=c(corange,cteal,cgrey),guide=FALSE) +
  labs(y="Frequency",x="Change in log10 Luminex Response (MFI-bg),\nfollow-up minus enrollment") +
  theme_minimal(base_size=14) +
  theme(legend.position = "top")

pdiff



```

Alternate visualization
```{r ab distribution of change2, fig.height=9, fig.width=6}

# Reorder the incidence category to be reversion/no change/conversion
dl2plot <- dl2 %>%
  mutate(serostat=factor(icat,levels=c("Seroreversion","No change","Seroconversion"))
  )

# calculate Ns in each seroconversion category to print in the figure
epiNs <- dl2plot %>%
  group_by(pathogen,antigenf,serostat) %>%
  summarize(n=n()) %>%
  filter(!is.na(serostat)) %>%
  mutate(nlab=paste("(n=",n,")",sep=""))


pcols <- c(cred,corange,cgreen,cchartr,cteal,cteal,cblue,cgrey)
set.seed(123)
diffmfi_byserostat <- ggplot(data=filter(dl2plot,!is.na(serostat)),aes(x=serostat,y=logmfidiff,fill=pathogen,color=pathogen)) +
  facet_wrap(~antigenf,nrow=6,ncol=2)+ 
  geom_jitter(position = position_jitter(width = 0.2), alpha = 0.2,pch=19) +
  geom_boxplot(notch=FALSE,outlier.color=NA,width=0.5,alpha=0.5,fill=NA,color="grey20")+
  geom_hline(aes(yintercept = 0)) +
  # add Ns
  geom_text(data=epiNs,aes(x=serostat,y=-3.25,label=nlab),col="gray40",size=2) +
  scale_y_continuous(expand=c(0,0),limits=c(-3.5,4.5),breaks=-3:4) +
  scale_fill_manual(values=pcols)+
  scale_color_manual(values=pcols)+
  labs(title="",x="Seroconversion status",y="Change in log10 Luminex Response (MFI-bg), follow-up minus enrollment") +
  theme_minimal(base_size=12)+
  theme(
    panel.grid.minor.x = element_blank(),
    axis.text.x=element_text(angle=45,hjust=1),
    legend.position="none"
  )

diffmfi_byserostat

# save a PDF version
ggsave("~/enterics-immuno-epi/figs/asembo-ab-mfidiff-byserostat.pdf",plot=diffmfi_byserostat,device="pdf",width=5,height=14)


```

# Seroincidence rate estimates
Estimates of the mean seroincidence rates during the study. The rates assume that incident sero-conversions and sero-reversions happened at the mid-point between measurements for each child.

As with the age-prevalence curve analysis, use information across multiple recombinant antigens for each pathogen when identifying risk periods and incident seroconversions and seroreversions.

```{r composite antigens}
#-----------------------------
# create composite 
# seropositivity indicators
# that use information from
# multiple antigens
#-----------------------------

dgi <- dlp %>% 
  filter(antigen %in% c("vsp3","vsp5")) %>%
  select(childid,time,tr,sex,age,agediff,pathogen,antigen,seropos) %>%
  spread(antigen,seropos) %>%
  mutate(seropos=ifelse(vsp3==1|vsp5==1,1,0),
         antigen="vsp3vsp5",
         antigenf="Giardia VSP-3 + VSP-5") %>%
  select(-vsp3,-vsp5)

dcr <- dlp %>% 
  filter(antigen %in% c("cp17","cp23")) %>%
  select(childid,time,tr,sex,age,agediff,pathogen,antigen,seropos) %>%
  spread(antigen,seropos) %>%
  mutate(seropos=ifelse(cp17==1|cp23==1,1,0),
         antigen="cp17cp23",
         antigenf="Cryptosporidium Cp17 + Cp23") %>%
  select(-cp17,-cp23)

ds <- dlp %>% 
  filter(antigen %in% c("salb","sald")) %>%
  select(childid,time,tr,sex,age,agediff,pathogen,antigen,seropos) %>%
  spread(antigen,seropos) %>%
  mutate(seropos=ifelse(salb==1|sald==1,1,0),
         antigen="salbsald",
         antigenf="Salmonella LPS groups B + D") %>%
  select(-salb,-sald)

dcp <- dlp %>% 
  filter(antigen %in% c("p18","p39")) %>%
  select(childid,time,tr,sex,age,agediff,pathogen,antigen,seropos) %>%
  spread(antigen,seropos) %>%
  mutate(seropos=ifelse(p18==1|p39==1,1,0),
         antigen="p18p39",
         antigenf="Campylobacter p18 + p39") %>%
  select(-p18,-p39)

dlp <- bind_rows(dlp,dgi,dcr,dcp,ds) %>%
  mutate(antigenf=factor(antigenf,
                         levels=c("Giardia VSP-3 + VSP-5",
                                  "Cryptosporidium Cp17 + Cp23",
                                  "E. histolytica LecA",
                                  "Rotavirus",
                                  "Salmonella LPS groups B + D",
                                  "ETEC toxin beta subunit",
                                  "Cholera toxin beta subunit",
                                  "Campylobacter p18 + p39")) ) %>%
  filter(!is.na(antigenf)) %>%
  select(pathogen,antigen,antigenf,
         childid,time,tr,sex,age,agediff,
         mfi,logmfi,logmfidiff,
         roccut,mixcut,unexp,unexpcut,serocut,serocut_desc,
         posroc,posmix,posunex,seropos) %>%
  arrange(pathogen,antigenf,childid,time)


#-----------------------------
# identify incident 
# seroconversions and reversions
#-----------------------------
# spread the data to wide format to 
# identify incident sero-conversions and sero-reversions
# subset to the individuals measured at both timepoints
dlpw <- dlp %>%
  select(childid,antigen,time,serocut,seropos) %>%
  spread(time,seropos) %>% 
  filter(!is.na(A) & !is.na(B)) %>%
  mutate(seroi=ifelse(B==1 & A==0,1,0),
         seror=ifelse(B==0 & A==1,1,0)) %>%
  select(childid,antigen,seroi,seror)

#  merge these new variables back to the main data
dlp2 <- left_join(dlp,dlpw,by=c("childid","antigen"))

```

Estimate prospective incidence rates

```{r long incidence rate estimates}
#-----------------------------
# estimate sero-incidence rates
# for conversion and reversion
# estimate SEs with a bootstrap
#-----------------------------
#-----------------------------
# filter to just 1 obs per child
# (enrolment information)
#-----------------------------
dp <- dlp2 %>% filter(time=="A")

#-----------------------------
# estimate time at risk
# for seroconversion and reversion
# assumed to be 1/2 of time
# between measurements
# if indivs are seropositive
# at measurement 1 they are
# not at risk for seroconversion
# (and vice-versa for seroreversion)
#-----------------------------
dp <- dp %>%
  mutate(ptc = ifelse(seropos==0,agediff/2,0),
         ptr = ifelse(seropos==1,agediff/2,0))

#-----------------------------
# estimate incidence rates
# for each antibody
# units are episodes per child-month
#-----------------------------
rate_ests <- dp %>%
  group_by(antigenf) %>%
  summarize(ni=sum(seroi,na.rm=T),
            nit=sum(ptc,na.rm=T),
            nr=sum(seror,na.rm=T),
            nrt=sum(ptr,na.rm=T)) %>%
  mutate(seroi=ni/nit,
         seror=nr/nrt)

#-----------------------------
# get bootstrap CIs
#-----------------------------
dboot <- dp %>%
  group_by(pathogen,antigen,antigenf) %>%
  select(pathogen,antigen,antigenf,seroi,seror,ptc,ptr)

set.seed(123)
bootests <- foreach(brep=1:1000,.combine=rbind) %dopar% {
    di <- sample_frac(dboot,size=1,replace=TRUE) %>%
      summarize_all(function(x) sum(x,na.rm=TRUE))
    }

rate_cis <- bootests %>% 
  group_by(pathogen,antigen,antigenf) %>%
  mutate(sero_c=seroi/ptc,sero_r=seror/ptr) %>%
  summarize(seroi_lb = quantile(sero_c,probs=c(0.025)),
            seroi_ub = quantile(sero_c,probs=c(0.975)),
            seror_lb = quantile(sero_r,probs=c(0.025),na.rm=T),
            seror_ub = quantile(sero_r,probs=c(0.975),na.rm=T)
            )

rate_ests <- left_join(rate_ests,rate_cis,by="antigenf") %>%
  select(pathogen,antigen,antigenf,ni,nit,starts_with("seroi"),nr,nrt,starts_with("seror"))


```

Table of results
```{r long incidence rate tables}
knitr::kable(select(rate_ests,antigenf,nit,ni,starts_with("seroi")),digits=3,
             caption="Incidence rates seroconversion per child month",
             col.names = c("Antigen","Months risk","n events","Incidence per month","min95","max95"),
             row.names = FALSE)


knitr::kable(select(rate_ests,antigenf,nrt,nr,starts_with("seror")),digits=3,
             caption="Incidence rates seroreversion per child month",
             col.names = c("Antigen","Months risk","n events","Incidence per month","min95","max95"),
             row.names = FALSE)

```


```{r seroincidence rate figure}

# reshape the rate estimates to long
rate_ests_i <- rate_ests %>% 
  select(pathogen,antigen,antigenf,n=ni,nt=nit,rate=seroi,rate_lb=seroi_lb,rate_ub=seroi_ub) %>%
  mutate(outcome="Seroconversion Rate")

rate_ests_r <- rate_ests %>% 
  select(pathogen,antigen,antigenf,n=nr,nt=nrt,rate=seror,rate_lb=seror_lb,rate_ub=seror_ub) %>%
  mutate(outcome="Seroreversion Rate")
rate_ests_long <- bind_rows(rate_ests_i,rate_ests_r)


# bright color-blind palette defined in an earlier code chunk
pcols <- c(cred,corange,cgreen,cchartr,cteal,cblue,cmagent,cgrey)

rateplot <- ggplot(data=rate_ests_long,aes(x=antigenf,y=rate,color=pathogen,fill=pathogen)) +
  geom_pointrange(aes(ymin=rate_lb,ymax=rate_ub)) +
  
  facet_wrap(~factor(outcome),nrow=2,ncol=1)+
  labs(x="",y="Incidence rate per child-month") +
  scale_fill_manual(values=pcols) +
  scale_color_manual(values=pcols) +
  # scale_color_identity(name = 'xxx', guide = 'legend',labels = c('m1',"m2")) +
  theme_minimal() +
  theme(legend.position = "none",
        axis.text.x=element_text(size=8,angle=45,hjust = 1),
        strip.text = element_text(size=12))

rateplot

# save a PDF version
ggsave("~/enterics-immuno-epi/figs/asembo-ab-long-seroincidence-rate-ests.pdf",plot=rateplot,device="pdf",width=5,height=5)


```


# Seroincidence proportion estimates
Estimates of the incidence proportion over a 6-7 month risk period for sero-conversion and sero-reversion, by antigen

```{r long incidence proportion estimates}
#-----------------------------
# estimate sero-incidence
# for conversion and reversion
# using exact binomial CIs
#-----------------------------
#-----------------------------
# filter to just 1 obs per child
# (enrolment information)
#-----------------------------
dp <- dlp2 %>% filter(time=="A")

#-----------------------------
# drop 38 children that were not 
# measured at both time points
#-----------------------------
table(dp$antigen,is.na(dp$seroi))
dp <- dp %>% filter(!is.na(seroi))

#-----------------------------
# drop 6 children that were
# measured longitudinally but
# not at 6- or 7 months between
# measurements to ensure a
# reasonably consistent risk 
# period
#-----------------------------
table(dp$agediff[dp$antigen=="etec"])
dp <- dp %>% filter(agediff>=6 & agediff<=7)

#-----------------------------
# function to estimate exact binomial CIs for
# incident sero-conversion and sero-reversion
#-----------------------------
exactprev <- function(x) {
  # x : a binary indicator of the outcome (1/0)
  tabx <- table(x)
  if(length(tabx)<2) {
    if(names(tabx)=="1") {
      tabx <- c(0,tabx)
    } else{
      tabx <- c(tabx,0)
    }
  } 
  estx <- binom.test(x=tabx[2],n=sum(tabx))
  res <- c(estx$parameter,estx$statistic,estx$estimate,estx$conf.int)
  names(res) <- c("N","n","mean","min95","max95")
  return(res)
}

#-----------------------------
# incident sero-conversions
# at risk conditional on
# being sero-negative at the
# first measurement (dp$seropos==0)
#-----------------------------
est_seroi <- foreach(ab=levels(dp$antigenf),.combine=rbind) %do% {
  res <- exactprev(dp$seroi[dp$antigenf==ab & dp$seropos==0])
  res <- data.frame(pathogen=dp$pathogen[dp$antigenf==ab][1],
                    antigenf=ab,
                    N=res[1],n=res[2],
                    mean=res[3],min95=res[4],max95=res[5])
  res
}
#-----------------------------
# incident sero-reversions
# at risk conditional on
# being sero-positive at the
# first measurement (dp$seropos==1)
#-----------------------------
est_seror <- foreach(ab=levels(dp$antigenf),.combine=rbind) %do% {
  res <- exactprev(dp$seror[dp$antigenf==ab & dp$seropos==1])
  res <- data.frame(pathogen=dp$pathogen[dp$antigenf==ab][1],
                    antigenf=ab,
                    N=res[1],n=res[2],
                    mean=res[3],min95=res[4],max95=res[5])
  res
}
```
Table of results
```{r long incidence proportion tables}
knitr::kable(select(est_seroi,-pathogen),digits=3,
             caption="Incidence proportion of seroconversion over a 6-month period",
             col.names = c("Antigen","N at risk","n events","Incidence per 100","min95","max95"),
             row.names = FALSE)


knitr::kable(select(est_seror,-pathogen),digits=3,
             caption="Incidence proportion of seroreversion over a 6-month period",
             col.names = c("Antigen","N at risk","n events","Incidence per 100","min95","max95"),
             row.names = FALSE)

```

Incidence proportion figure
```{r seroincidence proportion figure}

# code to plot conversion and reversion in a single panel (not used)
# seroip <- ggplot(data=est_seroi,aes(x=antigenf,y=mean,color=pathogen,fill=pathogen)) +
#   geom_pointrange(aes(ymin=min95,ymax=max95),
#                   position=position_nudge(x=-0.1)) +
#   geom_pointrange(data=est_seror,aes(ymin=min95,ymax=max95),
#                   pch=17,position=position_nudge(x=+0.1)
#                   )  +
#   labs(x="Antigen",y="Incidence proportion") +
#   scale_fill_manual(values=pcols) +
#   scale_color_manual(values=pcols) +
#   # scale_color_identity(name = 'xxx', guide = 'legend',labels = c('m1',"m2")) +
#   theme_minimal() +
#   theme(legend.position = "none",
#         axis.text.x=element_text(angle=45,hjust = 1))
# 
# seroip

# bind the incidence estimates together for plot aesthetics
est_sero <- est_seroi %>%
  mutate(outcome="Seroconversion Rate") %>%
  bind_rows(est_seror) %>%
  mutate(outcome=ifelse(is.na(outcome),"Seroreversion Rate",outcome))


# bright color-blind palette defined in an earlier code chunk
pcols <- c(cred,corange,cgreen,cchartr,cteal,cblue,cmagent,cgrey)

seroip <- ggplot(data=est_sero,aes(x=antigenf,y=mean*100,color=pathogen,fill=pathogen)) +
  geom_pointrange(aes(ymin=min95*100,ymax=max95*100)) +
  
  facet_wrap(~factor(outcome),nrow=2,ncol=1)+
  labs(x="",y="Incidence proportion per 100 children") +
  scale_fill_manual(values=pcols) +
  scale_color_manual(values=pcols) +
  # scale_color_identity(name = 'xxx', guide = 'legend',labels = c('m1',"m2")) +
  theme_minimal() +
  theme(legend.position = "none",
        axis.text.x=element_text(size=8,angle=45,hjust = 1),
        strip.text = element_text(size=12))

seroip

# save a PDF version
ggsave("~/enterics-immuno-epi/figs/asembo-ab-long-seroincidence-ests.pdf",plot=seroip,device="pdf",width=5,height=5)


```




# Save incidence estimates
```{r save estimates}
saveRDS(rate_ests_long,file="~/enterics-immuno-epi/output/asembo-enteric-ab-ests-incidencerates.rds")
saveRDS(est_seroi,file="~/enterics-immuno-epi/output/asembo-enteric-ab-ests-seroconversion.rds")
saveRDS(est_seror,file="~/enterics-immuno-epi/output/asembo-enteric-ab-ests-seroreversion.rds")
```

# Session Info
```{r session info}
sessionInfo()
```




